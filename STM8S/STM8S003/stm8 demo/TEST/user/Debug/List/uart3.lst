###############################################################################
#
# IAR C/C++ Compiler V3.10.1.201 for STM8                 08/Oct/2019  17:55:38
# Copyright 2010-2017 IAR Systems AB.
# Standalone license - IAR Embedded Workbench for STMicroelectronics STM8
#
#    Source file  =  
#        E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\drive\uart3.c
#    Command line =  
#        -f C:\Users\John\AppData\Local\Temp\EW51BF.tmp
#        ("E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\drive\uart3.c"
#        -e -Ol --no_cse --no_unroll --no_inline --no_code_motion --no_tbaa
#        --no_cross_call --debug --code_model small --data_model small -o
#        "E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\user\Debug\Obj"
#        --dlib_config "D:\Program Files (x86)\IAR Systems\Embedded Workbench
#        8.0\stm8\LIB\dlstm8ssf.h" -lcN
#        "E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\user\Debug\List"
#        -I "E:\workspace\DataSheet\STM8S\STM8S003\stm8
#        demo\TEST\user\..\lib\inc\" -I
#        "E:\workspace\DataSheet\STM8S\STM8S003\stm8
#        demo\TEST\user\..\lib\src\" -I
#        "E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\user\..\user\"
#        -I "E:\workspace\DataSheet\STM8S\STM8S003\stm8
#        demo\TEST\user\..\drive\" --vregs 16)
#    Locale       =  Chinese (Simplified)_CHN.936
#    List file    =  
#        E:\workspace\DataSheet\STM8S\STM8S003\stm8
#        demo\TEST\user\Debug\List\uart3.lst
#    Object file  =  
#        E:\workspace\DataSheet\STM8S\STM8S003\stm8
#        demo\TEST\user\Debug\Obj\uart3.o
#
###############################################################################

E:\workspace\DataSheet\STM8S\STM8S003\stm8 demo\TEST\drive\uart3.c
      1          #include "stm8s.h"
      2          #include "uart3.h"
      3          #include "stdio.h"
      4          
      5          /**************************
      6          
      7          UART3_RX->PD6;;;UART3_TX->PD5
      8          
      9          ***************************/
     10          
     11          void UART3_INIT(void)
     12          {
     13            UART3->CR2=0X00;//使能UART3
     14            UART3->CR1=0x00; //关闭UART3，设置数据位8位，禁止奇偶效验，禁止中断
     15            UART3->CR3=0x00; //一位停止位，默认值
     16            UART3->BRR2=0x0b; //设置波特率为115200,16MHZ,要先写BRR2。
     17            UART3->BRR1=0x08;
     18            UART3->CR2|=0X2C;//使能串口接收发送
     19          }
     20          
     21          
     22          void UART3_SendData(u8 ch)
     23          {
     24            while((UART3->SR & 0x80)==0x00);
     25            UART3->DR=ch;
     26          } 
     27          
     28          void Uart3SendDatas(u8 *Dat,u8 Len)
     29          {
     30             while(Len--)
     31            {
     32               UART3_SendData(*Dat++);
     33             }
     34          }
     35          
     36          void UART3_SendString(u8 *str)
     37          { 
     38            while(*str!= '\0')//判断字符串是否发送完毕
     39            {
     40              UART3_SendData(*str);//发送单个字符
     41              str++;//字符地址加1，指向先下一符
     42            }
     43          }
     44          
     45          
     46          #pragma vector=0x17
     47          __interrupt void UART3_RX_IRQHandler(void)
     48          { 
     49            volatile u8 USART3_RX_BUF; 
     50            while (!(UART3->SR & 0x20));
     51            USART3_RX_BUF=(u8)UART3->DR;
     52            
     53            UART3_SendData(USART3_RX_BUF);
     54          }
     55          
     56          

   Section sizes:

   Bytes  Function/Label
   -----  --------------
      29  UART3_INIT
      26  UART3_RX_IRQHandler
       9  UART3_SendData
      11  UART3_SendString
      19  Uart3SendDatas

 
 94 bytes in section .near_func.text
 
 94 bytes of CODE memory

Errors: none
Warnings: none
